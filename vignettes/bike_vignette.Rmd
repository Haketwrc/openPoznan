---
title: "vignette_for_bikes"
author: "Kamil Nowak"
date: "10 sierpnia 2018"
output: html_document
---

```{r setup, include=FALSE}
  library(openPoznan)
  library(jsonlite)
  library(purrr)
  library(plyr)
  library(dplyr)
  library(ggplot2)
  library(ggmap)
  library(leaflet)
  library(sp)
  library(rgeos)
  library(geosphere)
  library(gmapsdistance)
  library(XML)
  library(sqldf)
```

## Vignette for get_bike_place function.

```{r}
bike_place_example <- get_bike_place()
head(bike_place_example)
```

# Create map using gg plot, and put points on Poznan map.

```{r}
get_poznan <- get_map(c(16.916, 52.42), zoom = 12)
poznan <- ggmap(get_poznan)

poznan + geom_point(data=bike_place_example, aes(x=longitude, y=latitude))  +
  ylab("") + xlab("")
```
#Calculates the shortest distance between stations

```{r}

bike_place_example <- bike_place_example %>%
  mutate(id=1:nrow(bike_place_example))

bike_station_sp <- bike_place_example
coordinates(bike_station_sp) <- ~longitude + latitude

dist <- distm(bike_station_sp)
min_dist <- apply(dist, 1, function(x) order(x, decreasing=F)[2])

bike_station_dist <- cbind(bike_place_example, bike_place_example[min_dist,], 
                       apply(dist, 1, function(x) sort(x, decreasing=F)[2]))
colnames(bike_station_dist) <- c(colnames(bike_place_example), 
                             paste0("n_", colnames(bike_place_example)), "straight_distance")
bike_station_dist_2 <- sqldf("select * from bike_station_dist order by straight_distance")
head(bike_station_dist_2)


```
## Vignette for get_nextbike function.

```{r}
get_nextbike_example <- get_nextbike()
head(get_nextbike_example)
```
## Vignette for get_next_bike_data function.

```{r}
get_next_bike_data_example <- get_next_bike_data("10-08-2018 14:50","10-08-2018 15:10")
head(get_next_bike_data_example)
```

```{r}
data_table_final %>%
  filter(id=="6151") %>%
  group_by(date) %>%
  count() %>%
  ggplot(aes(x=n)) + geom_histogram(binwidth = 1)
```
# Liczba rowerów
```{r}

 data_table_final%>%
  distinct(number)%>%
  count()
```

#Liczba stacji rowerowych
```{r}
 data_table_final%>%
  distinct(id)%>%
  count()
```


# Liczba rowerów z podziałem na typy
```{r}
 data_table_final%>%
  group_by(bike_type)%>%
  distinct(number)%>%
  count()
```
# Liczba wypozyczonych rowerow w danej godzinie
```{r}
example  <- data_table_final %>%
  group_by(date) %>%
  count() %>%
  mutate(n_rent=1066-n)



```

#Mediana
```{r}
median(example$n_rent)
```

```{r}

ggplot(data = example, aes(n_rent)) + geom_histogram(binwidth = 10)


```

#Mediana wypożyczeń rowerów z kazdej godziny


```{r}

bike_hours <- example %>%
  mutate(hours = as.numeric(substring(date,12,13))) %>%
  group_by(hours) %>%
  summarise(sum=sum(n_rent))

bike_hours %>%
  ggplot(aes(x=hours, y=sum)) + geom_line()


```


```{r}
median <- bike_hours %>%
  group_by(hours)%>%
  summarise(mean = median(sum))

median
```
#Najwięcej wypożyczeń
```{r}
arrange(median,desc(mean))

```




